CASE_SENSITIVE="true"
export PATH="/usr/local/bin:/usr/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/games:/usr/local/games"
export PREFIX="/usr"
export DOTFILES=$HOME/.dotfiles

if [[ `uname` == 'Linux'  ]]
then
  export LINUX=1
  export GNU_USERLAND=1
else
  export LINUX=
fi

if [[ `uname` == 'Darwin'  ]]
then
  export OSX=1
  if [[ `uname -m` == 'arm64' ]]
  then
    export HOMEBREW_PREFIX="/opt/homebrew"
  else
    export HOMEBREW_PREFIX="/usr/local"
  fi
  if [[ -e $HOMEBREW_PREFIX/bin/brew ]]
  then
    eval "$(/opt/homebrew/bin/brew shellenv)"
    export PREFIX="$HOMEBREW_PREFIX"
    if [[ -e $HOMEBREW_PREFIX/opt/coreutils ]]; then export PATH="$HOMEBREW_PREFIX/opt/coreutils/libexec/gnubin:$PATH"; fi
    if [[ -e $HOMEBREW_PREFIX/opt/gnu-tar ]]; then export PATH="$HOMEBREW_PREFIX/opt/gnu-tar/libexec/gnubin:$PATH"; fi
    if [[ -e $HOMEBREW_PREFIX/opt/llvm ]]; then export PATH="$HOMEBREW_PREFIX/opt/llvm/bin:$PATH"; fi
    if [[ -e $HOMEBREW_PREFIX/opt/python ]]; then export PATH="$HOMEBREW_PREFIX/opt/python/libexec/bin:$PATH"; fi
  fi
else
  export OSX=
fi

export SHELL="$PREFIX/bin/zsh"
if [[ -e "$PREFIX/bin/tmux-next" ]]
then
  export TMUX_PATH="$PREFIX/bin/tmux-next"
else
  export TMUX_PATH="$PREFIX/bin/tmux"
fi

if [[ -e "$TMUX_PATH" ]]
then
  export TRUE_COLOR=`$TMUX_PATH info | grep Tc | grep -o true`
fi

if [[ "$SSH_CONNECTION" ]]
then
  export REMOTE_SESSION=1
else
  export REMOTE_SESSION=
fi

# source '$HOMEBREW_PREFIX/opt/asdf/asdf.sh'
# source '$HOMEBREW_PREFIX/opt/asdf/etc/bash_completion.d/asdf.bash'
#
alias brew='arch -arm64 brew'
alias ls='ls -F --color=auto'
#alias dir='dir --color=auto'
#alias vdir='vdir --color=auto'

alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# some more ls aliases
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'

# less alias
alias less='less -R'
export LESS='-R'
export LESSOPEN='|~/.lessfilter %s'

alias yolo='git commit -am "$(curl -s https://whatthecommit.com/index.txt)"'

if [[ -e `which nvim` ]]
then
  alias vim=nvim
  export GIT_EDITOR=nvim
  export VISUAL=nvim
  export EDITOR=nvim
else
  export GIT_EDITOR=vim
  export VISUAL=vim
  export EDITOR=vim
fi

export SHORT_PWD="$($PREFIX/bin/python3 $PREFIX/bin/super_pwd $PWD)"
function shorten_pwd() {
  export SHORT_PWD="$($PREFIX/bin/python3 $PREFIX/bin/super_pwd $PWD)"
}

chpwd_functions=(${chpwd_functions[@]} "shorten_pwd")

function tmux_window_pwd() {
  tmux rename-window "$SHORT_PWD"
}
precmd_functions=(${precmd_functions[@]} "tmux_window_pwd")

# eval "$(perl -I$HOME/perl5/lib/perl5 -Mlocal::lib=$HOME/perl5)"

homebrew_command_not_found_handle() {
  local cmd="$1"
  local txt="$(brew which-formula --explain $cmd 2>/dev/null)"

  if [ -z "$txt" ]; then
    echo "command not found: $cmd" >&2
  else
    echo "$txt"
  fi

  return 127
}

command_not_found_handler() {
  homebrew_command_not_found_handle $*
  return $?
}

export PYTHON_CONFIGURE_OPTS="--enable-framework"

export NVM_DIR="$HOME/.nvm"

export PATH="$HOME/.local/bin:$PATH"
. "$HOME/.cargo/env"
